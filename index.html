<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Backrooms Loader</title>
    <style>
      body {
        margin: 0;
        background: #000;
        color: #0f0;
        font-family: "Courier New", monospace;
        height: 100vh;
        overflow: hidden;
      }
      #loader,
      #main-menu,
      #sub-menu {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #log {
        width: 80%;
        max-width: 800px;
        height: 320px;
        overflow-y: auto;
        border: 1px solid #0f0;
        padding: 10px;
        margin-bottom: 20px;
        background: rgba(0, 15, 0, 0.1);
        font-size: 14px;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #0f0;
        border-top: 4px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .menu-title {
        font-size: 2.5em;
        margin-bottom: 30px;
        text-shadow: 0 0 10px #0f0;
      }
      .menu-btn,
      .level-btn {
        background: transparent;
        border: 2px solid #0f0;
        color: #0f0;
        padding: 12px 24px;
        margin: 8px;
        font-size: 1.2em;
        cursor: pointer;
        width: 280px;
        transition: all 0.3s ease;
      }
      .menu-btn:hover,
      .level-btn:hover {
        background: #0f0;
        color: #000;
        box-shadow: 0 0 20px #0f0;
      }
      @keyframes flashRed {
        0% {
          color: #f00;
          border-color: #f00;
        }
        50% {
          color: #000;
          border-color: #000;
          background: #f00;
        }
        100% {
          color: #f00;
          border-color: #f00;
          background: transparent;
        }
      }
      .scp-btn {
        border-color: #f00;
        color: #f00;
        text-shadow: 0 0 10px #f00;
        animation: flashRed 1s infinite;
      }
      .error {
        color: #f55;
      }
      .success {
        color: #0f0;
      }
      .scp-log {
        color: #f00;
        text-shadow: 0 0 5px #f00;
      }

      /* SCP warning overlay */
      #scp-warning {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        color: #f00;
        font-family: "Courier New", monospace;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        z-index: 999;
      }
      #scp-warning h2 {
        margin: 0 0 10px 0;
        text-shadow: 0 0 10px #f00;
      }
      #scp-warning p {
        margin: 0 0 20px 0;
      }
      #scp-pass {
        margin: 20px;
        padding: 10px;
        font-size: 1.2em;
        border: 2px solid #f00;
        background: #000;
        color: #f00;
        text-align: center;
      }
      #scp-warning button {
        margin: 10px;
        padding: 12px 24px;
        border: 2px solid #f00;
        background: transparent;
        color: #f00;
        cursor: pointer;
      }
      #scp-warning button:hover {
        background: #f00;
        color: #000;
        box-shadow: 0 0 20px #f00;
      }
      #scp-error {
        margin-top: 15px;
        color: #f55;
        min-height: 22px;
      }
    </style>
  </head>
  <body>
    <!-- Loader -->
    <div id="loader">
      <div class="spinner"></div>
      <div id="log"></div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu" style="display: none">
      <div class="menu-title">MAIN MENU</div>
      <button class="menu-btn" onclick="showCategory('backrooms')">
        Backrooms Levels
      </button>
      <button class="menu-btn scp-btn" onclick="showCategory('scp')">
        SCP Levels
      </button>
      <button class="menu-btn" onclick="showCategory('old')">Old Game</button>
    </div>

    <!-- Sub Menu -->
    <div id="sub-menu" style="display: none">
      <div class="menu-title" id="sub-title"></div>
      <div id="button-container"></div>
      <button class="menu-btn" onclick="returnToMain()">← Back</button>
    </div>

    <!-- SCP Warning Overlay -->
    <div id="scp-warning">
      <h2>⚠ SCP Containment Access Required ⚠</h2>
      <p>
        You are attempting to access a restricted SCP containment area.<br />
        Unauthorized entry may result in anomalous exposure.
      </p>
      <input
        id="scp-pass"
        type="password"
        placeholder="Enter containment passcode"
      />
      <div>
        <button id="scp-confirm">Confirm Entry</button>
        <button id="scp-cancel">Cancel</button>
      </div>
      <div id="scp-error"></div>
    </div>

    <!-- Siren audio -->
    <audio
      id="scp-siren"
      src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"
      preload="auto"
      loop
    ></audio>

    <script>
      // Files with categories for two-tier menu
      const files = [
        {
          // Level 0 now points to the cutscene file
          filename: "Level0CutScene.html",
          name: "Level 0 – Office Maze",
          category: "backrooms",
        },
        {
          filename: "Level1.html",
          name: "Level 1 – Parking Garage",
          category: "backrooms",
        },
        {
          filename: "Level37.html",
          name: "Level 37 – Poolrooms",
          category: "backrooms",
        },
        { filename: "TEMP.html", name: "Old Backrooms Game", category: "old" },
        { filename: "Level0v2.html", name: "SCP Level 0", category: "scp" },
      ];

      const validLevels = [];
      const log = document.getElementById("log");
      const loader = document.getElementById("loader");
      const mainMenu = document.getElementById("main-menu");
      const subMenu = document.getElementById("sub-menu");
      const buttonContainer = document.getElementById("button-container");
      const subTitle = document.getElementById("sub-title");

      // Dynamic passcode for SCP access; hinted in boot logs
      let SCP_PASSCODE = String(Math.floor(100 + Math.random() * 900));

      function addLog(msg, cls = "") {
        return new Promise((resolve) => {
          const line = document.createElement("div");
          line.textContent = msg;
          if (cls) line.className = cls;
          log.appendChild(line);
          log.scrollTop = log.scrollHeight;
          setTimeout(resolve, 300 + Math.random() * 400);
        });
      }

      async function fakeChecks() {
        const checks = [
          "Booting system kernel...",
          "Initializing memory modules...",
          "Calibrating rendering pipeline...",
          "Verifying asset integrity...",
          "Checking audio subsystem...",
          "Scanning network handshake...",
          "Decrypting anomaly registry...",
          "Loading procedural generation seeds...",
          "Running safety diagnostics...",
          "Preparing level registry...",
          "Starting level scan...",
          "Cross-referencing SCP containment files...",
          "Validating SCP Level entries...",
          "⚠️ Warning: anomalous entities detected...",
          "Containment protocols unstable...",
          "Proceed with extreme caution...",
        ];
        for (const c of checks) {
          const cls =
            c.includes("SCP") || c.includes("anomalous") ? "scp-log" : "";
          await addLog(c, cls);
        }
        await addLog(
          `Containment override token issued: ${SCP_PASSCODE}`,
          "scp-log"
        );
      }

      async function checkFile(file) {
        await addLog(`→ Scanning ${file.name} (${file.filename})...`);
        try {
          const res = await fetch(file.filename, { method: "HEAD" });
          if (res.ok) {
            validLevels.push(file);
            await addLog(
              `[✓] ${file.name} ${
                file.category === "scp" ? "anomaly verified" : "verified"
              }`,
              file.category === "scp" ? "scp-log" : "success"
            );
          } else {
            await addLog(`[✖] ${file.name} missing`, "error");
          }
        } catch {
          await addLog(`[✖] ${file.name} error`, "error");
        }
      }

      async function bootSequence() {
        await fakeChecks();
        for (const f of files) await checkFile(f);
        await addLog("Scan complete.");
        if (validLevels.length) {
          await addLog(`Found ${validLevels.length} valid level(s)`, "success");
          setTimeout(() => {
            loader.style.display = "none";
            mainMenu.style.display = "flex";
          }, 1200);
        } else {
          await addLog("No valid levels found.", "error");
        }
      }

      function showCategory(category) {
        mainMenu.style.display = "none";
        subMenu.style.display = "flex";
        buttonContainer.innerHTML = "";
        subTitle.textContent =
          category === "backrooms"
            ? "Backrooms Levels"
            : category === "scp"
            ? "SCP Levels"
            : "Old Game";

        validLevels
          .filter((l) => l.category === category)
          .forEach((level) => {
            const btn = document.createElement("button");
            btn.className = "level-btn";
            btn.textContent = level.name;

            if (level.category === "scp") {
              btn.classList.add("scp-btn");
              btn.onclick = () => showSCPWarning(level.filename, category);
            } else {
              btn.onclick = () => launchLevel(level.filename, category);
            }

            buttonContainer.appendChild(btn);
          });
      }

      function returnToMain() {
        subMenu.style.display = "none";
        mainMenu.style.display = "flex";
      }

      function showSCPWarning(file, category) {
        const warning = document.getElementById("scp-warning");
        const confirmBtn = document.getElementById("scp-confirm");
        const cancelBtn = document.getElementById("scp-cancel");
        const passInput = document.getElementById("scp-pass");
        const errorMsg = document.getElementById("scp-error");
        const siren = document.getElementById("scp-siren");

        warning.style.display = "flex";
        errorMsg.textContent = "";
        passInput.value = "";

        try {
          siren.currentTime = 0;
          siren.play().catch(() => {});
        } catch (e) {}

        confirmBtn.onclick = () => {
          if (passInput.value === SCP_PASSCODE) {
            try {
              siren.pause();
            } catch (e) {}
            warning.style.display = "none";
            launchLevel(file, category);
          } else {
            errorMsg.textContent = "Access denied. Invalid containment code.";
          }
        };

        cancelBtn.onclick = () => {
          try {
            siren.pause();
          } catch (e) {}
          warning.style.display = "none";
          subMenu.style.display = "flex";
        };
      }

      function launchLevel(file, category) {
        const iframe = document.createElement("iframe");
        iframe.src = file;
        Object.assign(iframe.style, {
          position: "fixed",
          top: "0",
          left: "0",
          width: "100%",
          height: "100%",
          border: "none",
          zIndex: "1000",
          background: "#000",
        });
        document.body.appendChild(iframe);
        subMenu.style.display = "none";

        const escHandler = (e) => {
          if (e.key === "Escape") {
            iframe.remove();
            subMenu.style.display = "flex";
            document.removeEventListener("keydown", escHandler);
          }
        };
        document.addEventListener("keydown", escHandler);
      }

      // Start boot sequence
      setTimeout(bootSequence, 1000);
    </script>
  </body>
</html>
